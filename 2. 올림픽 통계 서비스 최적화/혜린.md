# 2. 올림픽 통계 서비스 최적화

## 애니메이션 최적화

### 애니메이션의 원리

일반적인 디스플레이의 주사율은 60Hz. 즉 1초에 60장의 정지된 화면을 빠르게 보여준다는 의미이다.

따라서 브라우저도 이에 맞춰 최대 60FPS(Frames Per Second)로 1초에 60장의 화면을 새로 그린다.

애니메이션에서 끊김 현상이 생기는 이유는 CPU가 다른 일을 하느라 초당 60장의 화면을 그리지 못하고 40장, 20장의 화면을 그리기 때문

### 브라우저 렌더링 과정

1. DOM + CSSOM

    초기에는 HTML 파일과 CSS 등 화면을 그리는데 필요한 리소스를 다운로드 한다.
    
    다운로드한 HTML는 브라우저가 이해할 수 있는 형태로 변환(파싱)하고, 요소 간의 관계가 트리구조로 표현되어 있는 DOM을 만든다.
    
    CSS도 마찬가지로 위의 과정을 거쳐 CSSOM이라는 트리 구조를 생성한다.

2. 렌더 트리

    렌더트리는 DOM과 CSSOM의 결합으로 생성되며 화면에 표시되는 각 요소의 레이아웃을 계산하는데 사용된다. (= dispaly: none으로 설정하면 화면에 표시되지 않기 때문에 렌터 트리에 포함되지 않는다)

3. 레이아웃
  
    화면 구성 요소의 위치나 크기를 계산하고 해당 위치에 요소를 배치하는 작업을 한다.

4. 페인트

    화면에 배치된 요소에 색을 채워 넣는 작업을 한다. 이 때 브라우저는 효율적인 페인트 과정을 위해 구성 요소를 여러 개의 레이어로 나눠서 작업하기도 한다.

5. 컴포지트

    각 레이어를 합성한다.

### 리플로우와 리페인트

- 리플로우는 주요 렌더링 경로의 모든 단계를 모두 재실행 한다. 따라서 브라우저의 리소스를 많이 사용한다. ex. 화면 내 요소의 너비와 높이가 변경된 경우
- 리페인트는 CSSOM 생성, 렌더 트리 실행 이후 레이아웃 단계를 건너뛰고 페인트 단계, 컴포지트 단계를 거친다. ex. 글자 색, 배경 색 변경

transform, opcacity 와 같은 속성을 사용하면 리플로우와 리페인트를 피할 수 있다. 

이유는 해당 요소를 별도의 레이어로 분리하고 작업을 GPU에 위임해서 처리함으로써 **레이아웃과 페인트 단계를 건너뛸 수 있기 때문**이다. 이를 하드웨어 가속이라고 한다.

### 하드웨어 가속(GPU 가속)

CPU에서 처리해야 할 작업을 GPU에 위임하여 효율적으로 처리하는 방법.

GPU는 그래픽 작업을 처리하기 위해 만들어진 것으로 화면을 그릴 때 활용하면 굉장히 빠르다.

특정 요소에 하드웨어 가속을 사용하려면 요소를 별도의 레이어로 분리해서 CPU로 보내야 하며 transform, opacity가 이 역할을 한다.

분리된 레이어는 레이아웃, 페인트 단계 없이 GPU에 의해 처리된다.

## 컴포넌트 지연 로딩

### 사전 로딩

나중에 필요한 모듈을 필요해지기 전에 미리 로드하는 기법

### 사전 로딩 타이밍

1. 버튼 위에 마우스를 올려놓았을 때 ex. Next.js 의 Link 컴포넌트
2. 컴포넌트의 마운트 완료 후 사전 로딩 ex. useEffect 사용

## 이미지 사전 로딩

### 이미지 사전 로딩

자바스크립트의 Image 객체를 이용하는 방법
